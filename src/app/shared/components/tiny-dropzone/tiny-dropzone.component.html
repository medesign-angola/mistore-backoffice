<div class="dropzone w-full">
    <form [formGroup]="this.formGroup">
        <label [for]="'file-' + this.name" class="flex justify-center">
            @let errors = this.formGroup.get('file')?.errors;
            <div
            (fileDropped)="this.dropzoneOnChange($event)"
            class="dropzone-container cursor-pointer relative outline-dashed outline-black overflow-hidden"
            [ngClass]="{
                'w-full rounded-lg': this.layout() == 'rectangle',
                'w-[112px] rounded-full': this.layout() == 'circle',
            }"
            >
            <!-- (change)="this.emit()" -->
                <div
                [ngClass]="{
                    'h-[110px] justify-end pb-4': this.layout() == 'rectangle',
                    'h-[112px] justify-center': this.layout() == 'circle',
                }"
                class="image-centered-icon w-full flex gap-2 flex-col items-center">
                @if(!(this.files.length > 0)){
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16.495 4.50503L16 4.01005L15.0101 5L15.505 5.49497L16.495 4.50503ZM19 8L18.505 8.49497C18.7784 8.76834 19.2216 8.76834 19.495 8.49497L19 8ZM22.495 5.49497L22.99 5L22 4.01005L21.505 4.50503L22.495 5.49497ZM19.7 2V1.3H18.3V2H19.7ZM12.5 3.7C12.8866 3.7 13.2 3.3866 13.2 3C13.2 2.6134 12.8866 2.3 12.5 2.3V3.7ZM4.63803 20.673L4.32023 21.2967H4.32024L4.63803 20.673ZM3.32698 19.362L3.95069 19.0442H3.95068L3.32698 19.362ZM18.7765 20.8978L18.5953 20.2216L18.7765 20.8978ZM21.7 17C21.7 16.6134 21.3866 16.3 21 16.3C20.6134 16.3 20.3 16.6134 20.3 17H21.7ZM20.8978 18.7765L20.2216 18.5953L20.8978 18.7765ZM3.32698 4.63803L3.95068 4.95582H3.95069L3.32698 4.63803ZM4.63803 3.32698L4.95582 3.95069L4.63803 3.32698ZM14.99 11.9181L15.4609 12.4361H15.4609L14.99 11.9181ZM6.53115 19.608L7.00202 20.126L6.53115 19.608ZM19.8631 14.0905L20.3004 13.5438L19.8631 14.0905ZM17.0658 11.8527L17.5031 11.3061L17.0658 11.8527ZM20.9471 15.5042L21.6285 15.3442V15.3442L20.9471 15.5042ZM20.5733 14.7264L20.0226 15.1586V15.1586L20.5733 14.7264ZM19.1799 20.7582L19.4552 21.4018H19.4552L19.1799 20.7582ZM20.7582 19.1799L21.4018 19.4552V19.4552L20.7582 19.1799ZM5.79643 20.4442L6.49205 20.5223L5.79643 20.4442ZM5.96319 20.8755L5.50102 21.4013L5.50102 21.4013L5.96319 20.8755ZM15.7325 11.3627L15.5163 10.6969L15.7325 11.3627ZM16.2898 11.3451L16.116 12.0232L16.2898 11.3451ZM15.505 5.49497L18.505 8.49497L19.495 7.50503L16.495 4.50503L15.505 5.49497ZM19.495 8.49497L22.495 5.49497L21.505 4.50503L18.505 7.50503L19.495 8.49497ZM18.3 2V8H19.7V2H18.3ZM17 20.3H7.8V21.7H17V20.3ZM3.7 16.2V7.8H2.3V16.2H3.7ZM7.8 3.7H12.5V2.3H7.8V3.7ZM7.8 20.3C6.94837 20.3 6.35175 20.2995 5.88661 20.2615C5.42964 20.2241 5.16156 20.1541 4.95582 20.0493L4.32024 21.2967C4.75623 21.5189 5.22906 21.6124 5.7726 21.6568C6.30798 21.7005 6.97147 21.7 7.8 21.7V20.3ZM2.3 16.2C2.3 17.0285 2.29946 17.692 2.3432 18.2274C2.38761 18.7709 2.48113 19.2438 2.70328 19.6798L3.95068 19.0442C3.84586 18.8384 3.77588 18.5704 3.73855 18.1134C3.70054 17.6483 3.7 17.0516 3.7 16.2H2.3ZM4.95582 20.0493C4.52305 19.8288 4.17119 19.477 3.95069 19.0442L2.70328 19.6798C3.05801 20.376 3.62404 20.942 4.32023 21.2967L4.95582 20.0493ZM17 21.7C17.8849 21.7 18.4647 21.706 18.9576 21.5739L18.5953 20.2216C18.3252 20.294 17.975 20.3 17 20.3V21.7ZM20.3 17C20.3 17.975 20.294 18.3252 20.2216 18.5953L21.5739 18.9576C21.706 18.4647 21.7 17.8849 21.7 17H20.3ZM18.9576 21.5739C20.2345 21.2318 21.2318 20.2345 21.5739 18.9576L20.2216 18.5953C20.009 19.389 19.389 20.009 18.5953 20.2216L18.9576 21.5739ZM3.7 7.8C3.7 6.94837 3.70054 6.35175 3.73855 5.88661C3.77588 5.42964 3.84586 5.16156 3.95068 4.95582L2.70328 4.32024C2.48113 4.75623 2.38761 5.22906 2.3432 5.7726C2.29946 6.30798 2.3 6.97147 2.3 7.8H3.7ZM7.8 2.3C6.97147 2.3 6.30798 2.29946 5.7726 2.3432C5.22906 2.38761 4.75623 2.48113 4.32024 2.70328L4.95582 3.95069C5.16156 3.84586 5.42964 3.77588 5.88661 3.73855C6.35175 3.70054 6.94837 3.7 7.8 3.7V2.3ZM3.95069 4.95582C4.17119 4.52305 4.52305 4.17119 4.95582 3.95069L4.32024 2.70328C3.62404 3.05801 3.05801 3.62404 2.70328 4.32024L3.95069 4.95582ZM9.8 8.5C9.8 9.21797 9.21797 9.8 8.5 9.8V11.2C9.99117 11.2 11.2 9.99117 11.2 8.5H9.8ZM8.5 9.8C7.78203 9.8 7.2 9.21797 7.2 8.5H5.8C5.8 9.99117 7.00883 11.2 8.5 11.2V9.8ZM7.2 8.5C7.2 7.78203 7.78203 7.2 8.5 7.2V5.8C7.00883 5.8 5.8 7.00883 5.8 8.5H7.2ZM8.5 7.2C9.21797 7.2 9.8 7.78203 9.8 8.5H11.2C11.2 7.00883 9.99117 5.8 8.5 5.8V7.2ZM14.5192 11.4002L6.06028 19.0901L7.00202 20.126L15.4609 12.4361L14.5192 11.4002ZM7.06929 21.7H16.456V20.3H7.06929V21.7ZM20.3004 13.5438L17.5031 11.3061L16.6285 12.3993L19.4258 14.6371L20.3004 13.5438ZM21.7 16.456C21.7 16.005 21.7043 15.6671 21.6285 15.3442L20.2656 15.6641C20.2957 15.7922 20.3 15.9385 20.3 16.456H21.7ZM19.4258 14.6371C19.8298 14.9603 19.9414 15.0551 20.0226 15.1586L21.1239 14.2942C20.9191 14.0333 20.6525 13.8256 20.3004 13.5438L19.4258 14.6371ZM21.6285 15.3442C21.5387 14.9616 21.3665 14.6033 21.1239 14.2942L20.0226 15.1586C20.1394 15.3074 20.2223 15.4799 20.2656 15.6641L21.6285 15.3442ZM16.456 21.7C17.1657 21.7 17.7341 21.7004 18.1947 21.6681C18.6619 21.6353 19.0707 21.5663 19.4552 21.4018L18.9046 20.1146C18.7239 20.1919 18.4904 20.2439 18.0967 20.2715C17.6964 20.2996 17.1854 20.3 16.456 20.3V21.7ZM20.3 16.456C20.3 17.1854 20.2996 17.6964 20.2715 18.0967C20.2439 18.4904 20.1919 18.7239 20.1146 18.9046L21.4018 19.4552C21.5663 19.0707 21.6353 18.6619 21.6681 18.1947C21.7004 17.7341 21.7 17.1657 21.7 16.456H20.3ZM19.4552 21.4018C20.3303 21.0275 21.0275 20.3303 21.4018 19.4552L20.1146 18.9046C19.8819 19.4486 19.4486 19.8819 18.9046 20.1146L19.4552 21.4018ZM6.06028 19.0901C5.83255 19.2971 5.62649 19.4836 5.47918 19.643C5.35133 19.7813 5.13875 20.0282 5.1008 20.3661L6.49205 20.5223C6.48245 20.6079 6.45226 20.6575 6.45012 20.661C6.44905 20.6627 6.46164 20.6426 6.50734 20.5932C6.60318 20.4895 6.75397 20.3515 7.00202 20.126L6.06028 19.0901ZM7.06929 20.3C6.73405 20.3 6.52969 20.2994 6.38901 20.2871C6.32193 20.2812 6.2991 20.2748 6.30106 20.2754C6.30499 20.2766 6.36071 20.293 6.42535 20.3498L5.50102 21.4013C5.75634 21.6257 6.07975 21.6654 6.26741 21.6818C6.48363 21.7006 6.76151 21.7 7.06929 21.7V20.3ZM5.1008 20.3661C5.05703 20.7558 5.20646 21.1423 5.50102 21.4013L6.42535 20.3498C6.47444 20.3929 6.49935 20.4574 6.49205 20.5223L5.1008 20.3661ZM15.4609 12.4361C15.648 12.266 15.7599 12.1649 15.8494 12.0952C15.9319 12.0309 15.9545 12.0266 15.9488 12.0285L15.5163 10.6969C15.306 10.7652 15.1367 10.8757 14.9887 10.991C14.8477 11.1009 14.6906 11.2443 14.5192 11.4002L15.4609 12.4361ZM17.5031 11.3061C17.3221 11.1613 17.1564 11.0281 17.0087 10.9273C16.8538 10.8215 16.6778 10.7219 16.4636 10.667L16.116 12.0232C16.1102 12.0217 16.133 12.0246 16.2194 12.0835C16.313 12.1475 16.4311 12.2413 16.6285 12.3993L17.5031 11.3061ZM15.9488 12.0285C16.0029 12.0109 16.0609 12.0091 16.116 12.0232L16.4636 10.667C16.1514 10.587 15.8229 10.5974 15.5163 10.6969L15.9488 12.0285Z" fill="black"/>
                    </svg>
                } @else {
                    <img [src]="this.files[0].previewUrl" class="w-full absolute h-full duration-[.3s] top-0 left-0" alt="">
                }
                @if(this.layout() === 'rectangle' && !(this.files.length > 0)){
                <div class="tiny-description w-full">
                    <div class="text flex gap-2 py-0 justify-center items-center">
                        <!-- <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17.5 12.5V13.5C17.5 14.9001 17.5 15.6002 17.2275 16.135C16.9878 16.6054 16.6054 16.9878 16.135 17.2275C15.6002 17.5 14.9001 17.5 13.5 17.5H6.5C5.09987 17.5 4.3998 17.5 3.86502 17.2275C3.39462 16.9878 3.01217 16.6054 2.77248 16.135C2.5 15.6002 2.5 14.9001 2.5 13.5V12.5M14.1667 6.66667L10 2.5M10 2.5L5.83333 6.66667M10 2.5V12.5" stroke="black" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg> -->
                        <p class="text-[#828282] text-xs">
                            <span class="font-medium text-black"> Buscar</span>
                        </p>
                    </div>
                    @if (this.showDimentionsText()) {
                        <div class="text flex justify-center items-center">
                            <p class="text-[#aaa] text-xs">
                                Dimens√£o da imagem 1178x523
                            </p>
                        </div>
                    }
                </div>
                }
                </div>
                <input
                type="file"
                #fileInput
                [accept]="allowedFilesWithCommaSeparator()"
                (change)="dropzoneOnChange($event)"
                (change)="this.emit()"
                (change)="this.emitOutComeFiles()"
                [id]="'file-' + this.name"
                class=" absolute w-full h-full top-0 left-0 invisible"
                [multiple]="this.multi()">
            </div>
        </label>
    </form>

    @if(errors){
        <div class="errors-container mt-4">
            <small class="text-red-500 text-sm" *ngIf="errors['required']">{{ errors['required'] }}</small>
            <small class="text-red-500 text-sm" *ngIf="errors['fileSize']">{{ errors['fileSize'] }}</small>
            <small class="text-red-500 text-sm" *ngIf="errors['fileType']">{{ errors['fileType'] }}</small>
            <small class="text-red-500 text-sm" *ngIf="errors['totalSize']">{{ errors['totalSize'] }}</small>
        </div>
    }

    @if(this.showPreviewFiles()){
        <div class="uploaded-files mt-8">
            <div class="files flex flex-col gap-y-6" *ngIf="this.files.length > 0">                                
                @for (file of this.files; track $index) {
                    <div class="file p-3 bg-[#f8f8f8] border border-[#e9e9e9] rounded-lg flex gap-x-2 justify-start items-stretch">
                        <div class="image-preview relative! w-14! h-12! rounded overflow-hidden"
                        [ngClass]="{
                            'placeholder': !file.hasLoaded
                        }"
                        >
                            <img
                            (load)="imageHasLoaded($index)"
                            [ngClass]="{
                                'opacity-0': !file.hasLoaded,
                                'opacity-1': file.hasLoaded,
                            }"
                            src="{{ file.previewUrl }}"
                            class="object-fit duration-[.6s] object-center w-full h-full"
                            alt="">
                        </div>
                        <div class="file-details w-full flex justify-between items-center">
                            <div class="main-content w-[340px]">
                                <div class="filename mb-2">
                                    <p class="text-black text-sm font-medium max-w-[340px] limited-text one-line">
                                        {{ file.name }}
                                    </p>
                                </div>
                                <div class="tiny-details flex gap-x-2 justify-start items-center">
                                    <p class="text-[#aaa] text-sm limited-text one-line">
                                        {{ file.size | dataFormat:2 }}
                                    </p>
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <g clip-path="url(#clip0_42_5643)">
                                        <path d="M7.99992 14.6668C11.6818 14.6668 14.6666 11.6821 14.6666 8.00016C14.6666 4.31826 11.6818 1.3335 7.99992 1.3335C4.31802 1.3335 1.33325 4.31826 1.33325 8.00016C1.33325 11.6821 4.31802 14.6668 7.99992 14.6668Z" fill="#61C554"/>
                                        <path d="M4.99992 8.00016L6.99992 10.0002L10.9999 6.00016M14.6666 8.00016C14.6666 11.6821 11.6818 14.6668 7.99992 14.6668C4.31802 14.6668 1.33325 11.6821 1.33325 8.00016C1.33325 4.31826 4.31802 1.3335 7.99992 1.3335C11.6818 1.3335 14.6666 4.31826 14.6666 8.00016Z" stroke="white" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                                        </g>
                                        <defs>
                                        <clipPath id="clip0_42_5643">
                                        <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                        </defs>
                                    </svg>                                                    
                                </div>
                            </div>
                            <div class="aside-icons">
                                <a (click)="removeFileItem($index)" class="cursor-pointer">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="#999999" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>